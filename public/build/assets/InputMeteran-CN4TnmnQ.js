import{m as c,p as g,B as L,c as I,w as A,a as e,e as x,f as v,j as o,t as r,o as u,b as O,d as h,v as k,n as R,C as $,k as y}from"./app-CrMoLh5V.js";import{_ as q}from"./AppLayout-DuT1nYoU.js";/* empty css            */const H={class:"min-h-screen bg-gradient-to-br from-blue-50 to-blue-50 py-8 px-4"},E={class:"max-w-4xl mx-auto"},K={class:"bg-white rounded-2xl shadow-lg p-6 mb-6"},U={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},W={class:"font-bold text-gray-800"},J={class:"font-bold text-gray-800"},X={class:"font-bold text-gray-800"},Y={class:"font-bold text-gray-800"},G={key:0,class:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl shadow-lg p-6 mb-6 text-white"},Q={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Z={class:"bg-white/10 backdrop-blur rounded-lg p-4"},ee={class:"text-xl font-bold"},te={class:"bg-white/10 backdrop-blur rounded-lg p-4"},ae={class:"text-3xl font-bold"},se={class:"bg-white/10 backdrop-blur rounded-lg p-4"},ne={class:"text-2xl font-bold"},re={class:"bg-white rounded-2xl shadow-lg p-6 mb-6"},le={class:"flex items-center gap-3 px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg"},oe={class:"text-2xl font-bold text-gray-600"},ie={class:"relative"},de={key:0,class:"text-xs text-red-500 mt-1 flex items-center gap-1"},ue={key:1,class:"text-xs text-gray-500 mt-1"},me={key:0,class:"bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ge={class:"bg-white rounded-lg p-4 border border-green-100"},xe={class:"text-3xl font-bold text-green-600"},pe={class:"bg-white rounded-lg p-4 border border-green-100"},ce={class:"text-2xl font-bold text-gray-800"},fe={class:"bg-white rounded-lg p-4 border-2 border-green-200"},ve={class:"space-y-3"},he={class:"flex justify-between items-center"},ke={class:"font-semibold"},ye={class:"flex justify-between items-center"},we={class:"font-semibold"},_e={class:"border-t-2 border-gray-200 pt-3"},Me={class:"flex justify-between items-center"},je={class:"text-2xl font-bold text-green-600"},Be={class:"flex gap-4"},Ce=["disabled"],Se={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Te={class:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6"},De={class:"text-center"},ze={key:0,class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-5 mb-6 border-2 border-green-200"},Ne={class:"space-y-3"},Pe={class:"flex justify-between items-center"},Ve={class:"text-lg font-bold text-gray-800"},Fe={class:"border-t border-green-200 pt-3"},Le={class:"flex justify-between items-center"},Ie={class:"text-2xl font-bold text-green-600"},$e={__name:"InputMeteran",props:{pelanggan:Object,tagihan_terbaru:Object,tarif_aktif:Object},setup(l){const i=l,s=c({pelanggan_id:i.pelanggan.id,bulan:T(),meteran_sesudah:null,keterangan:""}),p=c(!1),w=c(!1),f=c(null),m=c(i.tagihan_terbaru?i.tagihan_terbaru.meteran_sesudah:0),d=g(()=>m.value),_=g(()=>{const a=parseFloat(s.value.meteran_sesudah);if(!a||isNaN(a)||s.value.meteran_sesudah===""||s.value.meteran_sesudah===null)return 0;const t=a-d.value;return Math.max(0,t)}),M=g(()=>{const a=_.value,t=i.tarif_aktif.minimal_pemakaian||10;return Math.max(a,t)}),j=g(()=>M.value*i.tarif_aktif.tarif_per_kubik),C=g(()=>!s.value.meteran_sesudah||s.value.meteran_sesudah===""?0:j.value+i.tarif_aktif.biaya_abunemen),S=g(()=>{const a=parseFloat(s.value.meteran_sesudah);return s.value.bulan&&s.value.meteran_sesudah!==""&&!isNaN(a)&&a>=d.value});function T(){const a=new Date,t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0");return`${t}-${n}`}async function D(){if(!(!S.value||p.value)){p.value=!0;try{const t=await(await fetch("/api/qr-scanner/store-meteran",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(s.value)})).json();t.success?(f.value=t.tagihan,w.value=!0):alert(t.message||"Terjadi kesalahan saat menyimpan data.")}catch(a){console.error("Error submitting form:",a),alert("Terjadi kesalahan saat menyimpan data.")}finally{p.value=!1}}}function z(){y.visit("/qr-scanner")}function N(a){if(!a)return null;let[t,n]=a.split("-").map(Number);return n=n-1,n===0&&(t-=1,n=12),`${t}-${String(n).padStart(2,"0")}`}async function P(a){if(!a)return;const t=N(a);if(!t){m.value=0;return}try{const n=await $.get(`/api/tagihan-bulanan/${i.pelanggan.id}/${t}`);n.data&&n.data.tagihan&&n.data.tagihan.meteran_sesudah>0?m.value=n.data.tagihan.meteran_sesudah:m.value=0}catch(n){n.response&&n.response.status===404||console.error("Error fetching meteran sebelum:",n),m.value=0}}L(()=>s.value.bulan,a=>{a&&P(a)},{immediate:!0});function V(){y.visit("/dashboard")}function B(){y.visit("/qr-scanner")}function F(a){return new Date(a).toLocaleDateString("id-ID",{year:"numeric",month:"long"})}function b(a){return new Intl.NumberFormat("id-ID").format(a)}return(a,t)=>(u(),I(q,null,{default:A(()=>[e("div",H,[e("div",E,[e("div",{class:"mb-6"},[e("button",{onClick:B,class:"text-blue-600 hover:text-blue-800 mb-4 flex items-center gap-2 font-medium"},[...t[3]||(t[3]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),o(" Kembali ke Scanner ",-1)])]),t[4]||(t[4]=e("div",{class:"text-center"},[e("h1",{class:"text-3xl font-bold text-gray-800 mb-2"},"Input Meteran Air"),e("p",{class:"text-gray-600"},"Masukkan pembacaan meteran air bulan ini")],-1))]),e("div",K,[t[9]||(t[9]=e("h2",{class:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),o(" Informasi Pelanggan ")],-1)),e("div",U,[e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm text-gray-500"},"ID Pelanggan",-1)),e("p",W,r(l.pelanggan.id_pelanggan),1)]),e("div",null,[t[6]||(t[6]=e("p",{class:"text-sm text-gray-500"},"Nama",-1)),e("p",J,r(l.pelanggan.nama_pelanggan),1)]),e("div",null,[t[7]||(t[7]=e("p",{class:"text-sm text-gray-500"},"RT / RW",-1)),e("p",X,"RT "+r(l.pelanggan.rt)+" / RW "+r(l.pelanggan.rw),1)]),e("div",null,[t[8]||(t[8]=e("p",{class:"text-sm text-gray-500"},"Wilayah",-1)),e("p",Y,r(l.pelanggan.wilayah||"-"),1)])])]),l.tagihan_terbaru?(u(),x("div",G,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold mb-4 flex items-center gap-2"},[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})]),o(" Meteran Terakhir ")],-1)),e("div",Q,[e("div",Z,[t[10]||(t[10]=e("p",{class:"text-blue-100 text-sm mb-1"},"Bulan",-1)),e("p",ee,r(F(l.tagihan_terbaru.bulan)),1)]),e("div",te,[t[11]||(t[11]=e("p",{class:"text-blue-100 text-sm mb-1"},"Meteran Akhir",-1)),e("p",ae,r(l.tagihan_terbaru.meteran_sesudah),1),t[12]||(t[12]=e("p",{class:"text-blue-100 text-xs"},"m³",-1))]),e("div",se,[t[13]||(t[13]=e("p",{class:"text-blue-100 text-sm mb-1"},"Pemakaian",-1)),e("p",ne,r(l.tagihan_terbaru.pemakaian_kubik),1),t[14]||(t[14]=e("p",{class:"text-blue-100 text-xs"},"m³",-1))])])])):v("",!0),e("div",re,[t[33]||(t[33]=e("h2",{class:"text-xl font-bold text-gray-800 mb-6 flex items-center gap-2"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})]),o(" Form Input Meteran Baru ")],-1)),e("form",{onSubmit:O(D,["prevent"]),class:"space-y-6"},[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[o(" Bulan "),e("span",{class:"text-red-500"},"*")],-1)),h(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>s.value.bulan=n),type:"month",required:"",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"},null,512),[[k,s.value.bulan]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," Meteran Sebelum ",-1)),e("div",le,[t[17]||(t[17]=e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})],-1)),e("span",oe,r(d.value),1),t[18]||(t[18]=e("span",{class:"text-sm text-gray-500 ml-auto"},"m³",-1))]),t[20]||(t[20]=e("p",{class:"text-xs text-gray-500 mt-1"},"Meteran terakhir yang tercatat",-1))]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"},[o(" Meteran Sesudah (Pembacaan Baru) "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ie,[h(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>s.value.meteran_sesudah=n),type:"number",step:"0.01",min:"0",required:"",placeholder:"Masukkan angka meteran saat ini",class:R(["w-full px-4 py-3 pr-12 border-2 border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition text-lg font-semibold",{"border-red-500":s.value.meteran_sesudah&&s.value.meteran_sesudah<d.value}])},null,2),[[k,s.value.meteran_sesudah,void 0,{number:!0}]]),t[21]||(t[21]=e("span",{class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium"},"m³",-1))]),s.value.meteran_sesudah&&s.value.meteran_sesudah<d.value?(u(),x("p",de,[...t[22]||(t[22]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1),o(" Meteran sesudah harus lebih besar atau sama dengan meteran sebelum! ",-1)])])):(u(),x("p",ue,"Masukkan angka yang tertera pada meteran air"))]),s.value.meteran_sesudah>=d.value?(u(),x("div",me,[t[30]||(t[30]=e("h3",{class:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2"},[e("svg",{class:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})]),o(" Perhitungan Tagihan ")],-1)),e("div",be,[e("div",ge,[t[24]||(t[24]=e("p",{class:"text-sm text-gray-600 mb-1"},"Pemakaian Air",-1)),e("p",xe,r(_.value.toFixed(2)),1),t[25]||(t[25]=e("p",{class:"text-xs text-gray-500"},"m³",-1))]),e("div",pe,[t[26]||(t[26]=e("p",{class:"text-sm text-gray-600 mb-1"},"Tarif per m³",-1)),e("p",ce,r(b(l.tarif_aktif.tarif_per_kubik)),1)])]),e("div",fe,[e("div",ve,[e("div",he,[t[27]||(t[27]=e("span",{class:"text-gray-600"},"Biaya Pemakaian",-1)),e("span",ke,r(M.value.toFixed(2))+" m³ × "+r(b(l.tarif_aktif.tarif_per_kubik))+" = "+r(b(j.value)),1)]),e("div",ye,[t[28]||(t[28]=e("span",{class:"text-gray-600"},"Biaya Abunemen",-1)),e("span",we,r(b(l.tarif_aktif.biaya_abunemen)),1)]),e("div",_e,[e("div",Me,[t[29]||(t[29]=e("span",{class:"text-lg font-bold text-gray-800"},"Total Tagihan",-1)),e("span",je,r(b(C.value)),1)])])])])])):v("",!0),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-semibold text-gray-700 mb-2"}," Keterangan (Opsional) ",-1)),h(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=n=>s.value.keterangan=n),rows:"3",placeholder:"Catatan tambahan (jika ada)...",class:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition resize-none"},null,512),[[k,s.value.keterangan]])]),e("div",Be,[e("button",{type:"button",onClick:B,class:"flex-1 px-6 py-4 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition"}," Batal "),e("button",{type:"submit",disabled:p.value||!s.value.meteran_sesudah||s.value.meteran_sesudah<d.value,class:"flex-1 px-6 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl font-semibold hover:from-blue-700 hover:to-blue-800 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[t[32]||(t[32]=e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),e("span",null,r(p.value?"Menyimpan...":"Simpan Meteran"),1)],8,Ce)])],32)])])]),w.value?(u(),x("div",Se,[e("div",Te,[e("div",De,[t[36]||(t[36]=e("div",{class:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4"},[e("svg",{class:"h-8 w-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),t[37]||(t[37]=e("h3",{class:"text-2xl font-bold text-gray-900 mb-2"},"Berhasil Disimpan!",-1)),t[38]||(t[38]=e("p",{class:"text-gray-600 mb-6"},"Data meteran berhasil dicatat dan tagihan telah dibuat",-1)),f.value?(u(),x("div",ze,[e("div",Ne,[e("div",Pe,[t[34]||(t[34]=e("span",{class:"text-sm text-gray-600"},"Pemakaian Air",-1)),e("span",Ve,r(f.value.pemakaian_kubik)+" m³",1)]),e("div",Fe,[e("div",Le,[t[35]||(t[35]=e("span",{class:"text-gray-700 font-semibold"},"Total Tagihan",-1)),e("span",Ie,"Rp "+r(b(f.value.total_tagihan)),1)])])])])):v("",!0),e("div",{class:"flex gap-3"},[e("button",{onClick:z,class:"flex-1 px-5 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition"}," Scan Lagi "),e("button",{onClick:V,class:"flex-1 px-5 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition"}," Dashboard ")])])])])):v("",!0)]),_:1}))}};export{$e as default};
