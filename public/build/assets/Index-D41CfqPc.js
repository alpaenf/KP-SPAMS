import{m as p,p as B,c as re,w as Ge,a as e,g as d,h as r,i as g,v,o as l,F as q,r as O,t as n,y as ce,n as V,e as b,j as N,M as ie,f as $,k as Fe,C as M}from"./app-ChDGowqM.js";import{_ as Ke}from"./AppLayout-BX4jkQhb.js";import{_ as ve}from"./InfoCicilan-Dgz2p2ZD.js";/* empty css            */const He={class:"py-12"},Ye={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Ee={class:"mb-6 lg:mb-8"},Je={class:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4 mb-4"},We={class:"flex flex-col sm:flex-row gap-3"},qe={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Oe={class:"relative"},Qe={class:"relative"},Xe=["value"],Ze={class:"mb-6 border-b border-gray-200"},ea={class:"-mb-px flex space-x-8"},aa={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6 mb-6"},ta={class:"bg-white rounded-lg shadow-md p-6"},sa={class:"flex items-center"},na={class:"ml-4"},la={class:"text-2xl font-bold text-gray-900"},oa={class:"bg-white rounded-lg shadow-md p-6"},ra={class:"flex items-center"},ia={class:"ml-4"},ua={class:"text-2xl font-bold text-gray-900"},da={class:"bg-white rounded-lg shadow-md p-6"},ga={class:"flex items-center"},ma={class:"ml-4"},pa={class:"text-2xl font-bold text-gray-900"},ba={class:"bg-white rounded-lg shadow-md p-6"},xa={class:"flex items-center"},ca={class:"ml-4"},va={class:"text-2xl font-bold text-gray-900"},ya={key:0,class:"mb-4 bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-center justify-between"},ha={class:"flex items-center gap-2"},fa={class:"text-blue-800 font-semibold"},_a={class:"flex gap-2"},ka=["disabled"],wa={class:"flex justify-end mb-3"},Ca={class:"bg-white rounded-lg shadow-md overflow-hidden"},Ba={class:"overflow-x-auto"},Ma={class:"min-w-full divide-y divide-gray-200"},ja={class:"bg-blue-800"},Aa={key:0,class:"px-4 py-3 text-center"},Ta=["checked"],Ia={class:"bg-white divide-y divide-gray-200"},La={key:0,class:"px-4 py-4 text-center"},Sa=["value","onChange"],Pa={class:"px-6 py-4 whitespace-nowrap"},Ua={class:"text-sm font-medium text-gray-900"},Va={class:"px-6 py-4 whitespace-nowrap"},Na={class:"flex items-center gap-2"},za={class:"text-sm font-medium text-gray-900"},Ra={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-bold bg-red-100 text-red-800",title:"Memiliki Tunggakan"},Da={class:"px-6 py-4 whitespace-nowrap"},$a={class:"text-sm text-gray-600"},Ga={class:"px-6 py-4 whitespace-nowrap"},Fa={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},Ka={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Ha={class:"px-6 py-4 whitespace-nowrap"},Ya={key:0,class:"inline-block"},Ea=["onUpdate:modelValue"],Ja={key:1,class:"text-sm text-gray-900"},Wa={class:"px-6 py-4 whitespace-nowrap"},qa={key:0,class:"inline-block"},Oa=["onUpdate:modelValue"],Qa={key:1,class:"text-sm text-gray-900"},Xa={class:"px-6 py-4 whitespace-nowrap"},Za={key:0,class:"text-sm font-medium text-blue-600"},et={key:1,class:"text-sm font-medium text-gray-900"},at={class:"px-6 py-4 whitespace-nowrap"},tt={key:0,class:"text-sm font-bold text-red-600"},st={key:1,class:"text-sm text-gray-400"},nt={class:"px-6 py-4 whitespace-nowrap"},lt={key:0,class:"space-y-1"},ot={class:"text-sm font-bold text-blue-600"},rt={key:0,class:"flex flex-col gap-1"},it={class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 w-fit"},ut={class:"text-xs text-purple-700 font-medium"},dt={key:1,class:"text-sm text-gray-400"},gt={class:"px-6 py-4 whitespace-nowrap"},mt={class:"flex flex-col gap-1"},pt={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800"},bt={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},xt={key:2,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"},ct={key:3,class:"inline-flex flex-col items-start gap-0.5"},vt={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},yt={class:"text-xs text-purple-700 font-medium ml-1"},ht={key:4,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"},ft={key:5,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800"},_t={key:6,class:"text-xs text-gray-400"},kt={class:"px-6 py-4 whitespace-nowrap text-sm"},wt=["onClick"],Ct={class:"px-6 py-4 whitespace-nowrap text-sm"},Bt={key:0,class:"flex gap-2"},Mt=["onClick"],jt=["onClick","title"],At={key:2,class:"text-xs text-green-600 font-medium"},Tt={key:3,class:"text-xs text-gray-400"},It={class:"flex items-center justify-center min-h-screen px-4"},Lt={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full p-6"},St={class:"space-y-4"},Pt={class:"flex items-center"},Ut={key:0},Vt={class:"border-t pt-4"},Nt={class:"flex items-start"},zt={class:"mt-6 flex gap-3"},Rt=["disabled"],Dt={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},$t={class:"bg-white rounded-lg shadow-md p-6"},Gt={class:"flex items-center"},Ft={class:"ml-4"},Kt={class:"text-2xl font-bold text-gray-900"},Ht={class:"bg-white rounded-lg shadow-md p-6"},Yt={class:"flex items-center"},Et={class:"ml-4"},Jt={class:"text-2xl font-bold text-gray-900"},Wt={class:"bg-white rounded-lg shadow-md p-6"},qt={class:"flex items-center"},Ot={class:"ml-4"},Qt={class:"text-2xl font-bold text-gray-900"},Xt={class:"bg-white rounded-lg shadow-md overflow-hidden"},Zt={class:"overflow-x-auto"},es={class:"min-w-full divide-y divide-gray-200"},as={class:"bg-white divide-y divide-gray-200"},ts={class:"px-6 py-4 whitespace-nowrap"},ss={class:"text-sm text-gray-900"},ns={class:"px-6 py-4 whitespace-nowrap"},ls={class:"text-sm font-medium text-gray-900"},os={class:"px-6 py-4 whitespace-nowrap"},rs={class:"text-sm font-medium text-gray-900"},is={class:"px-6 py-4 whitespace-nowrap"},us={class:"text-sm text-gray-600"},ds={class:"px-6 py-4 whitespace-nowrap"},gs={class:"text-sm text-gray-900"},ms={class:"px-6 py-4 whitespace-nowrap"},ps={class:"text-sm text-gray-600"},bs={class:"px-6 py-4 whitespace-nowrap"},xs={class:"text-sm text-gray-600"},cs={class:"px-6 py-4 whitespace-nowrap"},vs={class:"text-sm text-gray-600"},ys={class:"px-6 py-4 text-center"},hs={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},fs={key:1,class:"text-gray-400 text-sm"},_s={class:"px-6 py-4 whitespace-nowrap"},ks={class:"text-sm font-semibold text-gray-900"},ws={class:"px-6 py-4 whitespace-nowrap"},Cs={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"},Bs={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"},Ms={key:2,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},js={class:"px-6 py-4 whitespace-nowrap"},As={class:"text-sm text-gray-900"},Ts={class:"px-6 py-4"},Is={class:"text-sm text-gray-600 max-w-xs truncate"},Ls={class:"px-6 py-4 whitespace-nowrap text-center"},Ss=["onClick"],Ps={key:0},Us={colspan:"14",class:"px-6 py-12 text-center text-gray-500"},Vs={key:0},Ns={key:1},zs={class:"flex items-center justify-center min-h-screen px-4"},Rs={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full p-6"},Ds={class:"text-xl font-bold text-gray-900 mb-4"},$s={key:0,class:"mb-4 bg-purple-50 border border-purple-200 rounded-lg p-3"},Gs={class:"space-y-4"},Fs=["value"],Ks={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Hs={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Ys=["value"],Es={key:0},Js={key:0},Ws={class:"flex items-center"},qs={key:1},Os=["value"],Qs={class:"mt-6 flex gap-3"},Xs=["disabled"],Zs={class:"flex items-center justify-center min-h-screen px-4"},en={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full p-6"},an={key:0,class:"mb-4 bg-blue-50 border border-blue-200 rounded-lg p-3"},tn={class:"text-sm"},sn={class:"mt-2 text-lg font-bold text-blue-600"},nn={class:"space-y-4"},ln={key:0,class:"text-xs text-purple-600 mt-1 font-medium"},on={key:1,class:"text-xs text-gray-500 mt-1"},rn={class:"flex items-center space-x-3 cursor-pointer"},un={key:0,class:"bg-red-50 border border-red-200 rounded-lg overflow-hidden"},dn={class:"flex items-center gap-2"},gn={class:"text-sm font-medium text-red-800"},mn={class:"px-4 pb-4 border-t border-red-200"},pn={class:"flex items-start mt-3"},bn={class:"flex-1"},xn={class:"text-xs text-red-600 mt-2 space-y-1"},cn={class:"text-red-700"},vn={class:"font-bold text-red-900"},yn={key:0,class:"mt-3"},hn=["max"],fn={class:"text-xs text-red-600 mt-1"},_n={class:"block text-sm font-medium text-gray-700 mb-2"},kn={key:0,class:"text-blue-600 text-xs"},wn=["readonly"],Cn={key:0,class:"text-xs text-blue-600 mt-1"},Bn={class:"mt-6 flex gap-3"},Mn=["disabled"],jn={class:"flex items-center justify-center min-h-screen px-4"},An={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full p-6"},Tn={key:0,class:"space-y-4"},In={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Ln={class:"text-sm"},Sn={class:"text-sm"},Pn={class:"text-sm"},Un={class:"text-sm"},Vn={key:0},Nn=["src"],zn={key:1},Rn={class:"mt-6 flex gap-3"},Dn=["disabled"],$n=["disabled"],Gn={class:"flex items-center justify-center min-h-screen px-4"},Fn={class:"relative bg-white rounded-lg shadow-xl max-w-lg w-full p-6"},Kn={key:0,class:"space-y-4"},Hn={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Yn={class:"space-y-1 text-sm"},En={class:"space-y-2"},Jn={class:"text-base text-gray-900"},Wn={class:"text-base text-gray-900"},qn={class:"grid grid-cols-3 gap-4 bg-gray-50 p-3 rounded-lg"},On={class:"text-sm font-medium text-gray-900"},Qn={class:"text-sm font-medium text-gray-900"},Xn={class:"text-sm font-medium text-gray-900"},Zn={key:0},el={class:"text-2xl font-bold text-green-600"},al={class:"text-base text-gray-900"},tl={class:"text-base text-gray-900"},sl={key:1},nl={class:"text-base text-gray-900"},ul={__name:"Index",props:{pelangganList:Array,pembayaranList:Array,bulan:String},setup(ue){const j=ue,w=p(j.bulan),A=p(""),P=p(""),z=p(!1),Q=p(!1),X=p(!1),Z=p(!1),ee=p(!1),u=p(null),C=p(null),y=p(null),I=p(""),G=p(!1),F=p(!1),K=p(!1),T=p(!1),f=p([]),H=p(!1),c=p([]),x=p({}),Y=p(!1),L=p(!1),_=p({bulan:j.bulan,tarif_per_kubik:2e3,ada_abunemen:!0,biaya_abunemen:3e3,masukkan_tunggakan:!1}),m=p({meteran_sebelum:null,meteran_sesudah:null,tarif_per_kubik:2e3,ada_abunemen:!0,biaya_abunemen:3e3}),o=p({tanggal_bayar:new Date().toISOString().split("T")[0],meteran_sebelum:null,meteran_sesudah:null,jumlah_kubik:0,abunemen:!1,jumlah_bayar:0,keterangan:"",status_bayar:"BELUM_BAYAR",bayar_tunggakan:!1,jumlah_bayar_tunggakan:0}),de=B(()=>{const s=parseFloat(m.value.meteran_sebelum)||0;return(parseFloat(m.value.meteran_sesudah)||0)-s}),ye=B(()=>{if(u.value?.kategori==="sosial")return 0;const s=de.value,a=parseFloat(m.value.tarif_per_kubik)||0,t=s*a,i=m.value.ada_abunemen&&parseFloat(m.value.biaya_abunemen)||0;return t+i}),ge=B(()=>j.pelangganList.filter(s=>s.tagihan&&s.tagihan.meteran_sesudah!==null).length),he=B(()=>j.pelangganList.length-ge.value),fe=B(()=>j.pelangganList.filter(s=>s.tagihan&&s.tagihan.status_bayar==="SUDAH_BAYAR").length),U=p("tagihan"),_e=B(()=>{const s=new Set;return j.pelangganList.forEach(a=>{a.wilayah&&s.add(a.wilayah)}),Array.from(s).sort()}),R=B(()=>{let s=j.pelangganList;if(A.value){const a=A.value.toLowerCase();s=s.filter(t=>t.nama_pelanggan.toLowerCase().includes(a)||t.id_pelanggan.toLowerCase().includes(a))}return P.value&&(s=s.filter(a=>a.wilayah===P.value)),s}),E=B(()=>{let s=j.pembayaranList||[];if(A.value){const a=A.value.toLowerCase();s=s.filter(t=>t.pelanggan.nama_pelanggan.toLowerCase().includes(a)||t.pelanggan.id_pelanggan.toLowerCase().includes(a))}return P.value&&(s=s.filter(a=>a.pelanggan.wilayah===P.value)),s}),ae=B(()=>{const s=E.value,a=s.reduce((t,i)=>t+parseFloat(i.jumlah_bayar||0),0);return{totalCount:s.length,totalAmount:a,averageAmount:s.length>0?a/s.length:0}}),k=s=>parseInt(s).toLocaleString("id-ID"),me=s=>s?new Date(s).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"}):"-",J=s=>{const[a,t]=s.split("-");return`${["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][parseInt(t)-1]} ${a}`},ke=s=>s?new Date(s).toLocaleString("id-ID",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-",S=()=>{Fe.visit("/tagihan-bulanan",{data:{bulan:w.value},preserveState:!1})},we=async()=>{if(_.value.masukkan_tunggakan){if(!confirm("Yakin ingin memasukkan tunggakan ke tagihan bulan ini? Pelanggan yang punya tunggakan akan mendapat tagihan lebih besar."))return}else if(!confirm("Generate tagihan untuk semua pelanggan aktif?"))return;G.value=!0;try{const s=await M.post("/tagihan-bulanan/generate-bulk",_.value);alert(s.data.message),z.value=!1,S()}catch(s){alert("Gagal generate tagihan: "+(s.response?.data?.message||s.message))}finally{G.value=!1}},Ce=async s=>{if(s.tagihan&&s.tagihan.meteran_sesudah!==null){m.value.meteran_sebelum=s.tagihan.meteran_sebelum,m.value.meteran_sesudah=s.tagihan.meteran_sesudah,m.value.tarif_per_kubik=s.tagihan.tarif_per_kubik,m.value.ada_abunemen=s.tagihan.ada_abunemen,m.value.biaya_abunemen=s.tagihan.biaya_abunemen;return}const a=se(w.value);if(a){let t=!1,i=0;try{const h=await M.get(`/api/tagihan-bulanan/${s.id}/${a}`);h.data&&h.data.tagihan&&h.data.tagihan.meteran_sesudah>0&&(i=h.data.tagihan.meteran_sesudah,t=!0)}catch{console.log("Tidak ada tagihan bulan sebelumnya")}if(t){m.value.meteran_sebelum=i,m.value.meteran_sesudah=null;return}}m.value.meteran_sebelum=null,m.value.meteran_sesudah=null},Be=async s=>{u.value=s,m.value={meteran_sebelum:null,meteran_sesudah:null,tarif_per_kubik:2e3,ada_abunemen:!0,biaya_abunemen:3e3},Q.value=!0,await Ce(s)},te=()=>{Q.value=!1,u.value=null},se=s=>{if(!s)return null;let[a,t]=s.split("-").map(Number);return t=t-1,t===0&&(a-=1,t=12),`${a}-${String(t).padStart(2,"0")}`},Me=async s=>{if(s.tagihan&&s.tagihan.meteran_sesudah!==null){o.value.meteran_sebelum=s.tagihan.meteran_sebelum,o.value.meteran_sesudah=s.tagihan.meteran_sesudah,o.value.jumlah_kubik=s.tagihan.pemakaian_kubik,o.value.abunemen=s.tagihan.ada_abunemen;return}const a=se(w.value);if(a)try{const t=await M.get(`/api/tagihan-bulanan/${s.id}/${a}`);if(t.data&&t.data.tagihan&&t.data.tagihan.meteran_sesudah>0){o.value.meteran_sebelum=t.data.tagihan.meteran_sesudah,o.value.meteran_sesudah=null,o.value.jumlah_kubik=0;return}}catch{console.log("Tidak ada tagihan bulan sebelumnya")}o.value.meteran_sebelum=0,o.value.meteran_sesudah=null,o.value.jumlah_kubik=0},je=async s=>{u.value=s;const a=s.tagihan?.total_tagihan||0;o.value={tanggal_bayar:new Date().toISOString().split("T")[0],meteran_sebelum:null,meteran_sesudah:null,jumlah_kubik:0,abunemen:s.tagihan?.ada_abunemen||!1,jumlah_bayar:a,keterangan:"",status_bayar:"BELUM_BAYAR",catatan:"",bayar_tunggakan:!1,jumlah_bayar_tunggakan:0},X.value=!0;try{const t=await M.get(`/api/tagihan-bulanan/${s.id}/tunggakan`);t.data&&t.data.tunggakan?f.value=t.data.tunggakan:f.value=[]}catch(t){console.log("Error fetching tunggakan:",t),f.value=[]}await Me(s)},ne=()=>{const s=parseFloat(o.value.meteran_sebelum)||0,t=(parseFloat(o.value.meteran_sesudah)||0)-s;if(o.value.jumlah_kubik=t>0?t:0,o.value.status_bayar!=="CICILAN")if(u.value?.kategori==="sosial")o.value.jumlah_bayar=0;else{const i=o.value.jumlah_kubik*2e3,h=o.value.abunemen?3e3:0,oe=o.value.bayar_tunggakan?parseFloat(o.value.jumlah_bayar_tunggakan||0):0;o.value.jumlah_bayar=i+h+oe}},Ae=()=>{if(o.value.bayar_tunggakan){const s=f.value.reduce((a,t)=>a+t.sisa_tagihan,0);o.value.jumlah_bayar_tunggakan=s}else o.value.jumlah_bayar_tunggakan=0;pe()},pe=()=>{if(!u.value||o.value.status_bayar==="CICILAN")return;const s=u.value.tagihan?.total_tagihan||0,a=o.value.bayar_tunggakan?parseFloat(o.value.jumlah_bayar_tunggakan||0):0;o.value.jumlah_bayar=s+a},Te=()=>{if(!u.value)return;const s=o.value.status_bayar;if(s==="CICILAN"){const a=u.value.tagihan?.total_tagihan||0,t=u.value.tagihan?.jumlah_terbayar||0,i=a-t;o.value.jumlah_bayar=i>0?i:a}else if(s==="SUDAH_BAYAR"||s==="BELUM_BAYAR"||s==="TUNGGAKAN"){const a=u.value.tagihan?.total_tagihan||0;o.value.jumlah_bayar=a}},le=()=>{X.value=!1,u.value=null,f.value=[]},Ie=s=>{C.value=s,I.value="",Z.value=!0},W=()=>{Z.value=!1,C.value=null,I.value=""},Le=async()=>{if(confirm("Yakin ingin approve pembayaran ini?")){T.value=!0;try{await M.post(`/tagihan-bulanan/${C.value.tagihan.id}/approve-konfirmasi`,{catatan:I.value}),alert("Pembayaran berhasil di-approve!"),W(),S()}catch(s){alert("Gagal approve: "+(s.response?.data?.message||s.message))}finally{T.value=!1}}},Se=async()=>{if(!I.value){alert("Harap isi catatan alasan penolakan");return}if(confirm("Yakin ingin tolak konfirmasi pembayaran ini?")){T.value=!0;try{await M.post(`/tagihan-bulanan/${C.value.tagihan.id}/reject-konfirmasi`,{catatan:I.value}),alert("Konfirmasi pembayaran ditolak"),W(),S()}catch(s){alert("Gagal tolak: "+(s.response?.data?.message||s.message))}finally{T.value=!1}}},Pe=async()=>{K.value=!0;try{const s=u.value?.tagihan?.status_bayar,a=u.value?.tagihan?.bulan,i={bulan_bayar:s==="TUNGGAKAN"&&a?a:w.value,tanggal_bayar:o.value.tanggal_bayar,meteran_sebelum:o.value.meteran_sebelum,meteran_sesudah:o.value.meteran_sesudah,jumlah_kubik:o.value.jumlah_kubik,abunemen:o.value.abunemen,tunggakan:0,jumlah_bayar:o.value.jumlah_bayar,keterangan:o.value.keterangan||"",status_bayar:o.value.status_bayar,bayar_tunggakan:o.value.bayar_tunggakan,jumlah_bayar_tunggakan:o.value.jumlah_bayar_tunggakan||0,lunasi_tunggakan:s==="TUNGGAKAN"};o.value.bayar_tunggakan&&f.value.length>0&&(i.id_tunggakan=f.value.map(h=>h.id)),await M.post(`/pelanggan/${u.value.id}/pembayaran`,i),alert("Pembayaran berhasil disimpan!"),le(),S()}catch(s){alert("Gagal menyimpan pembayaran: "+(s.response?.data?.message||s.message))}finally{K.value=!1}},D=()=>{},Ue=()=>{L.value=!L.value,L.value||(c.value=[],x.value={})},Ve=s=>{s.target.checked?(c.value=R.value.map(a=>a.id),R.value.forEach(a=>{be(a)})):(c.value=[],x.value={})},be=async s=>{if(!c.value.includes(s.id)){delete x.value[s.id];return}if(x.value[s.id]={meteran_sebelum:0,meteran_sesudah:0,tarif_per_kubik:2e3,ada_abunemen:!0,biaya_abunemen:3e3},s.tagihan&&s.tagihan.meteran_sesudah!==null)x.value[s.id].meteran_sebelum=s.tagihan.meteran_sebelum,x.value[s.id].meteran_sesudah=s.tagihan.meteran_sesudah,x.value[s.id].tarif_per_kubik=s.tagihan.tarif_per_kubik||2e3,x.value[s.id].ada_abunemen=s.tagihan.ada_abunemen,x.value[s.id].biaya_abunemen=s.tagihan.biaya_abunemen||3e3;else{const a=se(w.value);if(a)try{const t=await M.get(`/api/tagihan-bulanan/${s.id}/${a}`);t.data&&t.data.tagihan&&t.data.tagihan.meteran_sesudah>0&&(x.value[s.id].meteran_sebelum=t.data.tagihan.meteran_sesudah)}catch{console.log("Tidak ada tagihan bulan sebelumnya untuk",s.nama_pelanggan)}}},Ne=(s,a)=>{const t=parseFloat(s)||0,i=parseFloat(a)||0;return Math.max(0,i-t)},ze=B(()=>c.value.length===0?!1:c.value.every(s=>{const a=x.value[s];if(!a)return!1;const t=parseFloat(a.meteran_sebelum)||0;return(parseFloat(a.meteran_sesudah)||0)>=t})),Re=async()=>{if(confirm(`Simpan data meteran untuk ${c.value.length} pelanggan?`)){Y.value=!0;try{const s=c.value.map(t=>{const i=j.pelangganList.find(oe=>oe.id===t),h=x.value[t];return{pelanggan_id:t,bulan:w.value,meteran_sebelum:parseFloat(h.meteran_sebelum)||0,meteran_sesudah:parseFloat(h.meteran_sesudah)||0,tarif_per_kubik:i?.kategori==="sosial"?0:parseFloat(h.tarif_per_kubik)||2e3,ada_abunemen:i?.kategori==="sosial"?!1:h.ada_abunemen??!0,biaya_abunemen:i?.kategori==="sosial"?0:parseFloat(h.biaya_abunemen)||3e3}}),a=await M.post("/tagihan-bulanan/batch-save",{items:s});alert(a.data.message||"Batch save berhasil!"),c.value=[],x.value={},S()}catch(s){alert("Gagal menyimpan batch: "+(s.response?.data?.message||s.message))}finally{Y.value=!1}}},De=async()=>{F.value=!0;try{const s=await M.post("/tagihan-bulanan",{pelanggan_id:u.value.id,bulan:w.value,...m.value});alert("Meteran berhasil disimpan!"),te(),S()}catch(s){alert("Gagal menyimpan meteran: "+(s.response?.data?.message||s.message))}finally{F.value=!1}},$e=s=>{y.value=s,ee.value=!0},xe=()=>{ee.value=!1,y.value=null};return(s,a)=>(l(),re(Ke,null,{default:Ge(()=>[e("div",He,[e("div",Ye,[e("div",Ee,[e("div",Je,[a[33]||(a[33]=e("div",null,[e("h1",{class:"text-2xl lg:text-3xl font-bold text-gray-900"},"Tagihan & Pembayaran Bulanan"),e("p",{class:"text-gray-600 mt-1 text-sm lg:text-base"},"Kelola meteran, tagihan, dan pembayaran pelanggan")],-1)),e("div",We,[d(e("input",{type:"month","onUpdate:modelValue":a[0]||(a[0]=t=>w.value=t),onChange:S,class:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800 focus:border-transparent text-sm"},null,544),[[v,w.value]]),e("button",{onClick:a[1]||(a[1]=t=>z.value=!0),class:"inline-flex items-center justify-center px-4 lg:px-6 py-2 lg:py-3 bg-blue-800 text-white rounded-lg font-semibold hover:bg-blue-900 transition text-sm lg:text-base whitespace-nowrap"},[...a[32]||(a[32]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),e("span",{class:"hidden sm:inline"},"Generate Tagihan Bulanan",-1),e("span",{class:"sm:hidden"},"Generate",-1)])])])]),e("div",qe,[e("div",Oe,[a[34]||(a[34]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),d(e("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=t=>A.value=t),placeholder:"Cari nama pelanggan...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-blue-800 focus:border-transparent sm:text-sm"},null,512),[[v,A.value]])]),e("div",Qe,[d(e("select",{"onUpdate:modelValue":a[3]||(a[3]=t=>P.value=t),class:"block w-full px-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white focus:outline-none focus:ring-2 focus:ring-blue-800 focus:border-transparent sm:text-sm"},[a[35]||(a[35]=e("option",{value:""},"Semua Wilayah",-1)),(l(!0),r(q,null,O(_e.value,t=>(l(),r("option",{key:t,value:t},n(t),9,Xe))),128))],512),[[ce,P.value]])])])]),e("div",Ze,[e("nav",ea,[e("button",{onClick:a[4]||(a[4]=t=>U.value="tagihan"),class:V(["whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm",U.value==="tagihan"?"border-blue-800 text-blue-800":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Input Tagihan ",2),e("button",{onClick:a[5]||(a[5]=t=>U.value="pembayaran"),class:V(["whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm",U.value==="pembayaran"?"border-blue-800 text-blue-800":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Daftar Pembayaran ",2)])]),e("div",aa,[e("div",ta,[e("div",sa,[a[37]||(a[37]=e("div",{class:"p-3 rounded-full bg-blue-100 text-blue-600"},[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})])],-1)),e("div",na,[a[36]||(a[36]=e("p",{class:"text-sm font-medium text-gray-500"},"Total Pelanggan",-1)),e("p",la,n(ue.pelangganList.length),1)])])]),e("div",oa,[e("div",ra,[a[39]||(a[39]=e("div",{class:"p-3 rounded-full bg-blue-100 text-blue-600"},[e("svg",{class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),e("div",ia,[a[38]||(a[38]=e("p",{class:"text-sm font-medium text-gray-500"},"Sudah Input Meteran",-1)),e("p",ua,n(ge.value),1)])])]),e("div",da,[e("div",ga,[a[41]||(a[41]=e("div",{class:"p-3 rounded-full bg-yellow-100 text-yellow-600"},[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",ma,[a[40]||(a[40]=e("p",{class:"text-sm font-medium text-gray-500"},"Belum Input Meteran",-1)),e("p",pa,n(he.value),1)])])]),e("div",ba,[e("div",xa,[a[43]||(a[43]=e("div",{class:"p-3 rounded-full bg-blue-100 text-blue-600"},[e("svg",{class:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),e("div",ca,[a[42]||(a[42]=e("p",{class:"text-sm font-medium text-gray-500"},"Sudah Bayar",-1)),e("p",va,n(fe.value),1)])])])]),d(e("div",null,[c.value.length>0?(l(),r("div",ya,[e("div",ha,[a[44]||(a[44]=e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1)),e("span",fa,n(c.value.length)+" pelanggan dipilih",1)]),e("div",_a,[e("button",{onClick:a[6]||(a[6]=t=>c.value=[]),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition text-sm"}," Batal Pilih "),e("button",{onClick:Re,disabled:Y.value||!ze.value,class:"px-6 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition text-sm disabled:opacity-50 disabled:cursor-not-allowed"},n(Y.value?"Menyimpan...":"Simpan Semua ("+c.value.length+")"),9,ka)])])):g("",!0),e("div",wa,[e("button",{onClick:Ue,class:V(["flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition border",L.value?"bg-blue-800 text-white border-blue-800 hover:bg-blue-700":"bg-white text-blue-800 border-blue-800 hover:bg-blue-50"])},[a[45]||(a[45]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),b(" "+n(L.value?"Tutup Mode Pilih":"Pilih & Simpan Semua"),1)],2)]),e("div",Ca,[e("div",Ba,[e("table",Ma,[e("thead",ja,[e("tr",null,[L.value?(l(),r("th",Aa,[e("input",{type:"checkbox",onChange:Ve,checked:c.value.length===R.value.length&&R.value.length>0,class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",title:"Pilih Semua"},null,40,Ta)])):g("",!0),a[46]||(a[46]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"ID",-1)),a[47]||(a[47]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Nama Pelanggan",-1)),a[48]||(a[48]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Wilayah",-1)),a[49]||(a[49]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Kategori",-1)),a[50]||(a[50]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Meteran Sebelum (m³)",-1)),a[51]||(a[51]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Meteran Sesudah (m³)",-1)),a[52]||(a[52]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Pemakaian (m³)",-1)),a[53]||(a[53]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Tunggakan",-1)),a[54]||(a[54]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Total Tagihan",-1)),a[55]||(a[55]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Status",-1)),a[56]||(a[56]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Aksi",-1)),a[57]||(a[57]=e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Pembayaran",-1))])]),e("tbody",Ia,[(l(!0),r(q,null,O(R.value,t=>(l(),r("tr",{key:t.id,class:V(["hover:bg-gray-50 transition-colors",{"bg-blue-50":c.value.includes(t.id)}])},[L.value?(l(),r("td",La,[d(e("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":a[7]||(a[7]=i=>c.value=i),onChange:i=>be(t),class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,40,Sa),[[N,c.value]])])):g("",!0),e("td",Pa,[e("div",Ua,n(t.id_pelanggan),1)]),e("td",Va,[e("div",Na,[e("div",za,n(t.nama_pelanggan),1),t.tunggakan&&t.tunggakan>0?(l(),r("span",Ra,[...a[58]||(a[58]=[e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),b(" ! ",-1)])])):g("",!0)])]),e("td",Da,[e("span",$a,n(t.wilayah||"-"),1)]),e("td",Ga,[t.kategori==="sosial"?(l(),r("span",Fa," Sosial ")):(l(),r("span",Ka," Umum "))]),e("td",Ha,[c.value.includes(t.id)&&x.value[t.id]?(l(),r("div",Ya,[d(e("input",{type:"number","onUpdate:modelValue":i=>x.value[t.id].meteran_sebelum=i,step:"0.01",placeholder:"0.00",class:"w-24 px-2 py-1 border border-blue-300 rounded text-sm focus:ring-2 focus:ring-blue-500"},null,8,Ea),[[v,x.value[t.id].meteran_sebelum,void 0,{number:!0}]])])):(l(),r("div",Ja,n(t.tagihan?.meteran_sebelum??"-"),1))]),e("td",Wa,[c.value.includes(t.id)&&x.value[t.id]?(l(),r("div",qa,[d(e("input",{type:"number","onUpdate:modelValue":i=>x.value[t.id].meteran_sesudah=i,step:"0.01",placeholder:"0.00",class:"w-24 px-2 py-1 border border-blue-300 rounded text-sm focus:ring-2 focus:ring-blue-500"},null,8,Oa),[[v,x.value[t.id].meteran_sesudah,void 0,{number:!0}]])])):(l(),r("div",Qa,n(t.tagihan?.meteran_sesudah??"-"),1))]),e("td",Xa,[c.value.includes(t.id)&&x.value[t.id]?(l(),r("div",Za,n(Ne(x.value[t.id].meteran_sebelum,x.value[t.id].meteran_sesudah).toFixed(2)),1)):(l(),r("div",et,n(t.tagihan?.pemakaian_kubik??"-"),1))]),e("td",at,[t.tunggakan&&t.tunggakan>0?(l(),r("div",tt,n(k(t.tunggakan)),1)):(l(),r("div",st,"-"))]),e("td",nt,[t.tagihan?(l(),r("div",lt,[e("div",ot,n(k(t.tagihan.total_tagihan)),1),t.tagihan.status_bayar==="CICILAN"&&t.tagihan.jumlah_terbayar>0?(l(),r("div",rt,[e("span",it," Cicilan "+n(Math.round(t.tagihan.jumlah_terbayar/t.tagihan.total_tagihan*100))+"% ",1),e("span",ut,n(k(t.tagihan.jumlah_terbayar))+" / "+n(k(t.tagihan.total_tagihan)),1)])):g("",!0)])):(l(),r("div",dt,"Belum ada"))]),e("td",gt,[e("div",mt,[t.tagihan?.status_konfirmasi==="pending"?(l(),r("span",pt,[...a[59]||(a[59]=[e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"})],-1),b(" Pending Konfirmasi ",-1)])])):t.tagihan?.status_bayar==="SUDAH_BAYAR"?(l(),r("span",bt,[...a[60]||(a[60]=[e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1),b(" Sudah Bayar ",-1)])])):t.tunggakan&&t.tunggakan>0?(l(),r("span",xt,[...a[61]||(a[61]=[e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293z","clip-rule":"evenodd"})],-1),b(" Nunggak ",-1)])])):t.tagihan&&t.tagihan.status_bayar==="CICILAN"&&t.tagihan.status_konfirmasi==="none"?(l(),r("span",ct,[e("span",vt,[a[62]||(a[62]=e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"})],-1)),b(" Cicilan "+n(Math.round(t.tagihan.jumlah_terbayar/t.tagihan.total_tagihan*100))+"% ",1)]),e("span",yt,n(k(t.tagihan.jumlah_terbayar))+" / "+n(k(t.tagihan.total_tagihan)),1)])):t.tagihan&&t.tagihan.status_bayar==="BELUM_BAYAR"&&t.tagihan.status_konfirmasi==="none"?(l(),r("span",ht,[...a[63]||(a[63]=[e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),b(" Belum Bayar ",-1)])])):t.tagihan&&t.tagihan.status_bayar==="TUNGGAKAN"&&t.tagihan.status_konfirmasi==="none"?(l(),r("span",ft,[...a[64]||(a[64]=[e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"})],-1),b(" Tunggakan ",-1)])])):t.tagihan?g("",!0):(l(),r("span",_t,"-"))])]),e("td",kt,[e("button",{onClick:i=>Be(t),class:"text-blue-600 hover:text-blue-800 transition font-medium",title:"Input Meteran"},[...a[65]||(a[65]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,wt)]),e("td",Ct,[t.tagihan?.status_konfirmasi==="pending"?(l(),r("div",Bt,[e("button",{onClick:i=>Ie(t),class:"inline-flex items-center px-3 py-1.5 bg-orange-600 text-white text-xs font-medium rounded-md hover:bg-orange-700 transition",title:"Lihat Bukti & Approve"},[...a[66]||(a[66]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),b(" Verifikasi ",-1)])],8,Mt)])):t.tagihan&&(t.tagihan.status_bayar==="BELUM_BAYAR"||t.tagihan.status_bayar==="CICILAN"||t.tagihan.status_bayar==="TUNGGAKAN")&&t.tagihan.status_konfirmasi==="none"?(l(),r("button",{key:1,onClick:i=>je(t),class:"inline-flex items-center px-3 py-1.5 bg-green-600 text-white text-xs font-medium rounded-md hover:bg-green-700 transition",title:t.tagihan.status_bayar==="CICILAN"?"Lanjutkan Cicilan":t.tagihan.status_bayar==="TUNGGAKAN"?"Bayar Tunggakan":"Input Pembayaran"},[a[67]||(a[67]=e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})],-1)),b(" "+n(t.tagihan.status_bayar==="CICILAN"?"Cicilan":"Bayar"),1)],8,jt)):t.tagihan?.status_bayar==="SUDAH_BAYAR"?(l(),r("span",At," ✓ Lunas ")):(l(),r("span",Tt,"-"))])],2))),128))])])])])],512),[[ie,U.value==="tagihan"]])]),z.value?(l(),r("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:a[14]||(a[14]=$(t=>z.value=!1,["self"]))},[e("div",It,[a[74]||(a[74]=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),e("div",Lt,[a[73]||(a[73]=e("h3",{class:"text-xl font-bold text-gray-900 mb-4"},"Generate Tagihan Bulanan",-1)),e("div",St,[e("div",null,[a[68]||(a[68]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bulan",-1)),d(e("input",{type:"month","onUpdate:modelValue":a[8]||(a[8]=t=>_.value.bulan=t),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800 focus:border-transparent"},null,512),[[v,_.value.bulan]])]),e("div",null,[a[69]||(a[69]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tarif per m³ (Rp)",-1)),d(e("input",{type:"number","onUpdate:modelValue":a[9]||(a[9]=t=>_.value.tarif_per_kubik=t),step:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800 focus:border-transparent"},null,512),[[v,_.value.tarif_per_kubik]])]),e("div",null,[e("label",Pt,[d(e("input",{type:"checkbox","onUpdate:modelValue":a[10]||(a[10]=t=>_.value.ada_abunemen=t),class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,512),[[N,_.value.ada_abunemen]]),a[70]||(a[70]=e("span",{class:"ml-2 text-sm text-gray-700"},"Ada Biaya Abunemen",-1))])]),_.value.ada_abunemen?(l(),r("div",Ut,[a[71]||(a[71]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Biaya Abunemen (Rp)",-1)),d(e("input",{type:"number","onUpdate:modelValue":a[11]||(a[11]=t=>_.value.biaya_abunemen=t),step:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800 focus:border-transparent"},null,512),[[v,_.value.biaya_abunemen]])])):g("",!0),e("div",Vt,[e("label",Nt,[d(e("input",{type:"checkbox","onUpdate:modelValue":a[12]||(a[12]=t=>_.value.masukkan_tunggakan=t),class:"mt-1 rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,512),[[N,_.value.masukkan_tunggakan]]),a[72]||(a[72]=e("span",{class:"ml-2"},[e("span",{class:"text-sm font-medium text-gray-700"},"Masukkan Tunggakan ke Tagihan Bulan Ini"),e("span",{class:"block text-xs text-gray-500 mt-1"},"Tunggakan dari bulan sebelumnya akan otomatis ditambahkan ke total tagihan")],-1))])])]),e("div",zt,[e("button",{onClick:we,disabled:G.value,class:"flex-1 px-4 py-2 bg-blue-800 text-white rounded-lg font-medium hover:bg-blue-900 transition disabled:opacity-50"},n(G.value?"Generating...":"Generate"),9,Rt),e("button",{onClick:a[13]||(a[13]=t=>z.value=!1),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition"}," Batal ")])])])])):g("",!0)]),d(e("div",null,[e("div",Dt,[e("div",$t,[e("div",Gt,[a[76]||(a[76]=e("div",{class:"p-3 rounded-full bg-blue-100 text-blue-600"},[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})])],-1)),e("div",Ft,[a[75]||(a[75]=e("p",{class:"text-sm font-medium text-gray-500"},"Total Pembayaran",-1)),e("p",Kt,n(ae.value.totalCount),1)])])]),e("div",Ht,[e("div",Yt,[a[78]||(a[78]=e("div",{class:"p-3 rounded-full bg-green-100 text-green-600"},[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",Et,[a[77]||(a[77]=e("p",{class:"text-sm font-medium text-gray-500"},"Total Pemasukan",-1)),e("p",Jt,"Rp "+n(k(ae.value.totalAmount)),1)])])]),e("div",Wt,[e("div",qt,[a[80]||(a[80]=e("div",{class:"p-3 rounded-full bg-purple-100 text-purple-600"},[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})])],-1)),e("div",Ot,[a[79]||(a[79]=e("p",{class:"text-sm font-medium text-gray-500"},"Rata-rata Pembayaran",-1)),e("p",Qt,"Rp "+n(k(ae.value.averageAmount)),1)])])])]),e("div",Xt,[e("div",Zt,[e("table",es,[a[83]||(a[83]=e("thead",{class:"bg-blue-800"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Tanggal"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"ID Pelanggan"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Nama Pelanggan"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Wilayah"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Bulan Bayar"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"M. Sebelum"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"M. Sesudah"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Pemakaian"),e("th",{class:"px-6 py-3 text-center text-xs font-medium text-white uppercase tracking-wider"},"Abunemen"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Jumlah Bayar"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Keterangan"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Metode"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider"},"Catatan"),e("th",{class:"px-6 py-3 text-center text-xs font-medium text-white uppercase tracking-wider"},"Aksi")])],-1)),e("tbody",as,[(l(!0),r(q,null,O(E.value,t=>(l(),r("tr",{key:t.id,class:"hover:bg-gray-50"},[e("td",ts,[e("div",ss,n(me(t.tanggal_bayar)),1)]),e("td",ns,[e("div",ls,n(t.pelanggan.id_pelanggan),1)]),e("td",os,[e("div",rs,n(t.pelanggan.nama_pelanggan),1)]),e("td",is,[e("div",us,n(t.pelanggan.wilayah||"-"),1)]),e("td",ds,[e("div",gs,n(J(t.bulan_bayar)),1)]),e("td",ms,[e("div",ps,n(t.meteran_sebelum||"-"),1)]),e("td",bs,[e("div",xs,n(t.meteran_sesudah||"-"),1)]),e("td",cs,[e("div",vs,n(t.jumlah_kubik?t.jumlah_kubik+" m³":"-"),1)]),e("td",ys,[t.abunemen?(l(),r("span",hs,[...a[81]||(a[81]=[e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1),b(" Ya ",-1)])])):(l(),r("span",fs,"-"))]),e("td",_s,[e("div",ks,"Rp "+n(k(t.jumlah_bayar)),1)]),e("td",ws,[t.keterangan==="Nunggak"?(l(),r("span",Cs,n(t.keterangan),1)):t.keterangan==="Cicilan"?(l(),r("span",Bs,n(t.keterangan),1)):(l(),r("span",Ms,n(t.keterangan||"Lunas"),1))]),e("td",js,[e("div",As,n(t.metode_bayar),1)]),e("td",Ts,[e("div",Is,n(t.catatan||"-"),1)]),e("td",Ls,[e("button",{onClick:i=>$e(t),class:"text-blue-600 hover:text-blue-900 transition",title:"Lihat Detail"},[...a[82]||(a[82]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,Ss)])]))),128)),!E.value||E.value.length===0?(l(),r("tr",Ps,[e("td",Us,[A.value?(l(),r("div",Vs,' Tidak ada pembayaran yang sesuai dengan pencarian "'+n(A.value)+'" ',1)):(l(),r("div",Ns," Belum ada pembayaran di bulan ini "))])])):g("",!0)])])])])],512),[[ie,U.value==="pembayaran"]]),Q.value?(l(),r("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:$(te,["self"])},[e("div",zs,[a[94]||(a[94]=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),e("div",Rs,[e("h3",Ds," Input Meteran - "+n(u.value?.nama_pelanggan),1),u.value?.kategori==="sosial"?(l(),r("div",$s,[...a[84]||(a[84]=[e("p",{class:"text-sm text-purple-700"},[e("strong",null,"Pelanggan Kategori Sosial:"),b(" Tidak dikenakan biaya (gratis) ")],-1)])])):g("",!0),e("div",Gs,[e("div",null,[a[85]||(a[85]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bulan Tagihan",-1)),e("input",{type:"month",value:w.value,readonly:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"},null,8,Fs),a[86]||(a[86]=e("p",{class:"text-xs text-gray-500 mt-1"},"Bulan yang sedang dipilih di halaman utama",-1))]),e("div",Ks,[e("div",null,[a[87]||(a[87]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Meteran Sebelum (m³)",-1)),d(e("input",{type:"number","onUpdate:modelValue":a[15]||(a[15]=t=>m.value.meteran_sebelum=t),step:"0.01",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800 focus:border-transparent",onInput:D},null,544),[[v,m.value.meteran_sebelum]])]),e("div",null,[a[88]||(a[88]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Meteran Sesudah (m³)",-1)),d(e("input",{type:"number","onUpdate:modelValue":a[16]||(a[16]=t=>m.value.meteran_sesudah=t),step:"0.01",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800 focus:border-transparent",onInput:D},null,544),[[v,m.value.meteran_sesudah]])])]),e("div",Hs,[e("div",null,[a[89]||(a[89]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pemakaian (m³)",-1)),e("input",{type:"number",value:de.value,readonly:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"},null,8,Ys)]),u.value?.kategori!=="sosial"?(l(),r("div",Es,[a[90]||(a[90]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tarif per m³ (Rp)",-1)),d(e("input",{type:"number","onUpdate:modelValue":a[17]||(a[17]=t=>m.value.tarif_per_kubik=t),step:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800 focus:border-transparent",onInput:D},null,544),[[v,m.value.tarif_per_kubik]])])):g("",!0)]),u.value?.kategori!=="sosial"?(l(),r("div",Js,[e("label",Ws,[d(e("input",{type:"checkbox","onUpdate:modelValue":a[18]||(a[18]=t=>m.value.ada_abunemen=t),class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",onChange:D},null,544),[[N,m.value.ada_abunemen]]),a[91]||(a[91]=e("span",{class:"ml-2 text-sm text-gray-700"},"Ada Biaya Abunemen",-1))])])):g("",!0),m.value.ada_abunemen&&u.value?.kategori!=="sosial"?(l(),r("div",qs,[a[92]||(a[92]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Biaya Abunemen (Rp)",-1)),d(e("input",{type:"number","onUpdate:modelValue":a[19]||(a[19]=t=>m.value.biaya_abunemen=t),step:"100",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800 focus:border-transparent",onInput:D},null,544),[[v,m.value.biaya_abunemen]])])):g("",!0),e("div",null,[a[93]||(a[93]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Total Tagihan (Rp)",-1)),e("input",{type:"text",value:k(ye.value),readonly:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-blue-50 font-bold text-blue-600"},null,8,Os)])]),u.value?.tagihan?(l(),re(ve,{key:1,"total-tagihan":u.value.tagihan.total_tagihan||0,"jumlah-terbayar":u.value.tagihan.jumlah_terbayar||0,"status-bayar":u.value.tagihan.status_bayar||"BELUM_BAYAR",class:"mt-4"},null,8,["total-tagihan","jumlah-terbayar","status-bayar"])):g("",!0),e("div",Qs,[e("button",{onClick:De,disabled:F.value,class:"flex-1 px-4 py-2 bg-blue-800 text-white rounded-lg font-medium hover:bg-blue-900 transition disabled:opacity-50"},n(F.value?"Menyimpan...":"Simpan"),9,Xs),e("button",{onClick:te,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition"}," Batal ")])])])])):g("",!0),X.value?(l(),r("div",{key:1,class:"fixed inset-0 z-50 overflow-y-auto",onClick:$(le,["self"])},[e("div",Zs,[a[114]||(a[114]=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),e("div",en,[a[113]||(a[113]=e("h3",{class:"text-xl font-bold text-gray-900 mb-4"},"Input Pembayaran",-1)),u.value?(l(),r("div",an,[e("div",tn,[e("p",null,[a[95]||(a[95]=e("strong",null,"ID:",-1)),b(" "+n(u.value.id_pelanggan),1)]),e("p",null,[a[96]||(a[96]=e("strong",null,"Nama:",-1)),b(" "+n(u.value.nama_pelanggan),1)]),e("p",null,[a[97]||(a[97]=e("strong",null,"Bulan:",-1)),b(" "+n(J(w.value)),1)]),e("p",sn," Total Tagihan: "+n(k(u.value.tagihan?.total_tagihan||0)),1)])])):g("",!0),u.value?.tagihan?(l(),re(ve,{key:1,"total-tagihan":u.value.tagihan.total_tagihan||0,"jumlah-terbayar":u.value.tagihan.jumlah_terbayar||0,"status-bayar":u.value.tagihan.status_bayar||"BELUM_BAYAR",class:"mb-4"},null,8,["total-tagihan","jumlah-terbayar","status-bayar"])):g("",!0),e("div",nn,[e("div",null,[a[98]||(a[98]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Bayar",-1)),d(e("input",{type:"date","onUpdate:modelValue":a[20]||(a[20]=t=>o.value.tanggal_bayar=t),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800",required:""},null,512),[[v,o.value.tanggal_bayar]])]),e("div",null,[a[99]||(a[99]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Meteran Sebelum (m³)",-1)),d(e("input",{type:"number","onUpdate:modelValue":a[21]||(a[21]=t=>o.value.meteran_sebelum=t),step:"0.01",placeholder:"0.00",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800",onInput:ne},null,544),[[v,o.value.meteran_sebelum]]),a[100]||(a[100]=e("p",{class:"text-xs text-gray-500 mt-1"},"Angka meteran bulan lalu",-1))]),e("div",null,[a[101]||(a[101]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Meteran Sesudah (m³)",-1)),d(e("input",{type:"number","onUpdate:modelValue":a[22]||(a[22]=t=>o.value.meteran_sesudah=t),step:"0.01",placeholder:"0.00",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800",onInput:ne},null,544),[[v,o.value.meteran_sesudah]]),a[102]||(a[102]=e("p",{class:"text-xs text-gray-500 mt-1"},"Angka meteran bulan ini",-1))]),e("div",null,[a[103]||(a[103]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Pemakaian (m³)",-1)),d(e("input",{type:"number","onUpdate:modelValue":a[23]||(a[23]=t=>o.value.jumlah_kubik=t),step:"0.01",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800 bg-gray-50",readonly:""},null,512),[[v,o.value.jumlah_kubik]]),u.value?.kategori==="sosial"?(l(),r("p",ln,"Tarif: Gratis (Kategori Sosial)")):(l(),r("p",on,"Tarif: Rp 2.000 / m³"))]),e("div",null,[e("label",rn,[d(e("input",{type:"checkbox","onUpdate:modelValue":a[24]||(a[24]=t=>o.value.abunemen=t),onChange:ne,class:"w-5 h-5 text-blue-800 border-gray-300 rounded focus:ring-2 focus:ring-blue-800"},null,544),[[N,o.value.abunemen]]),a[104]||(a[104]=e("div",null,[e("span",{class:"text-sm font-medium text-gray-700"},"Abunemen"),e("p",{class:"text-xs text-gray-500"},"Biaya tambahan: Rp 3.000")],-1))])]),f.value.length>0?(l(),r("div",un,[e("button",{type:"button",onClick:a[25]||(a[25]=t=>H.value=!H.value),class:"w-full p-4 flex items-center justify-between hover:bg-red-100 transition text-left"},[e("div",dn,[a[105]||(a[105]=e("svg",{class:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",gn," ⚠️ Ada Tunggakan ("+n(f.value.length)+" bulan) - Rp "+n(Number(f.value.reduce((t,i)=>t+i.sisa_tagihan,0)).toLocaleString("id-ID")),1)]),(l(),r("svg",{class:V(["w-5 h-5 text-red-600 transition-transform",H.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...a[106]||(a[106]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),d(e("div",mn,[e("div",pn,[d(e("input",{type:"checkbox","onUpdate:modelValue":a[26]||(a[26]=t=>o.value.bayar_tunggakan=t),onChange:Ae,class:"mt-1 mr-3 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"},null,544),[[N,o.value.bayar_tunggakan]]),e("div",bn,[a[108]||(a[108]=e("label",{class:"text-sm font-medium text-red-800"}," Bayar Tunggakan Sekarang ",-1)),e("div",xn,[(l(!0),r(q,null,O(f.value,t=>(l(),r("div",{key:t.id,class:"flex justify-between py-1 border-b border-red-200 last:border-0"},[e("span",cn,n(J(t.bulan)),1),e("span",vn,"Rp "+n(Number(t.sisa_tagihan).toLocaleString("id-ID")),1)]))),128))]),o.value.bayar_tunggakan?(l(),r("div",yn,[a[107]||(a[107]=e("label",{class:"block text-sm font-medium text-red-800 mb-1"},[b(" Jumlah Bayar Tunggakan (Rp) "),e("span",{class:"text-xs font-normal text-red-600"},"- Bisa bayar sebagian/cicil")],-1)),d(e("input",{type:"number","onUpdate:modelValue":a[27]||(a[27]=t=>o.value.jumlah_bayar_tunggakan=t),onInput:pe,step:"1000",min:"0",max:f.value.reduce((t,i)=>t+i.sisa_tagihan,0),class:"w-full px-3 py-2 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 bg-white",placeholder:"Isi jumlah bayar tunggakan (bisa cicil)"},null,40,hn),[[v,o.value.jumlah_bayar_tunggakan]]),e("p",fn," 💡 Isi sesuai kemampuan (misal: Rp 5.000 dari total Rp "+n(Number(f.value.reduce((t,i)=>t+i.sisa_tagihan,0)).toLocaleString("id-ID"))+") ",1)])):g("",!0)])])],512),[[ie,H.value]])])):g("",!0),e("div",null,[e("label",_n,[b(n(o.value.status_bayar==="CICILAN"?"Jumlah Cicilan":"Jumlah Bayar")+" (Rp) ",1),o.value.status_bayar==="CICILAN"?(l(),r("span",kn,"- Bisa diedit")):g("",!0)]),d(e("input",{type:"number","onUpdate:modelValue":a[28]||(a[28]=t=>o.value.jumlah_bayar=t),class:V(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800",o.value.status_bayar==="CICILAN"||o.value.bayar_tunggakan?"bg-white":"bg-gray-50"]),step:"1000",min:"0",required:"",readonly:o.value.status_bayar!=="CICILAN"&&!o.value.bayar_tunggakan},null,10,wn),[[v,o.value.jumlah_bayar]]),o.value.status_bayar==="CICILAN"?(l(),r("p",Cn,"💡 Untuk cicilan, isi jumlah berapa saja (misal: Rp 1.000, Rp 5.000, dll)")):g("",!0)]),e("div",null,[a[110]||(a[110]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[b("Status Bayar "),e("span",{class:"text-red-500"},"*")],-1)),d(e("select",{"onUpdate:modelValue":a[29]||(a[29]=t=>o.value.status_bayar=t),onChange:Te,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800",required:""},[...a[109]||(a[109]=[e("option",{value:"BELUM_BAYAR"},"⏳ Belum Bayar - Bulan ini belum dibayar",-1),e("option",{value:"CICILAN"},"🔄 Cicilan - Bayar sebagian",-1),e("option",{value:"SUDAH_BAYAR"},"✅ Sudah Bayar - Lunas penuh",-1),e("option",{value:"TUNGGAKAN"},"📌 Tunggakan - Input bulan lalu yang nunggak",-1)])],544),[[ce,o.value.status_bayar]]),a[111]||(a[111]=e("p",{class:"text-xs text-gray-500 mt-1"}," Pilih status pembayaran pelanggan ",-1))]),e("div",null,[a[112]||(a[112]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan",-1)),d(e("input",{type:"text","onUpdate:modelValue":a[30]||(a[30]=t=>o.value.keterangan=t),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800",placeholder:"Catatan bebas (opsional)..."},null,512),[[v,o.value.keterangan]])])]),e("div",Bn,[e("button",{onClick:Pe,disabled:K.value,class:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition disabled:opacity-50"},n(K.value?"Menyimpan...":"Simpan Pembayaran"),9,Mn),e("button",{onClick:le,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition"}," Batal ")])])])])):g("",!0),Z.value?(l(),r("div",{key:2,class:"fixed inset-0 z-50 overflow-y-auto",onClick:$(W,["self"])},[e("div",jn,[a[123]||(a[123]=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),e("div",An,[a[122]||(a[122]=e("h3",{class:"text-xl font-bold text-gray-900 mb-4"},"Verifikasi Konfirmasi Pembayaran",-1)),C.value?(l(),r("div",Tn,[e("div",In,[e("p",Ln,[a[115]||(a[115]=e("strong",null,"ID Pelanggan:",-1)),b(" "+n(C.value.id_pelanggan),1)]),e("p",Sn,[a[116]||(a[116]=e("strong",null,"Nama:",-1)),b(" "+n(C.value.nama_pelanggan),1)]),e("p",Pn,[a[117]||(a[117]=e("strong",null,"Total Tagihan:",-1)),b(" "+n(k(C.value.tagihan?.total_tagihan||0)),1)]),e("p",Un,[a[118]||(a[118]=e("strong",null,"Waktu Konfirmasi:",-1)),b(" "+n(ke(C.value.tagihan?.konfirmasi_at)),1)])]),C.value.tagihan?.bukti_transfer?(l(),r("div",Vn,[a[119]||(a[119]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Bukti Transfer:",-1)),e("img",{src:`/storage/${C.value.tagihan.bukti_transfer}`,alt:"Bukti Transfer",class:"w-full max-h-96 object-contain border rounded-lg"},null,8,Nn)])):(l(),r("div",zn,[...a[120]||(a[120]=[e("p",{class:"text-sm text-gray-500 italic"},"Tidak ada bukti transfer yang diupload",-1)])])),e("div",null,[a[121]||(a[121]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Catatan (Opsional)",-1)),d(e("textarea",{"onUpdate:modelValue":a[31]||(a[31]=t=>I.value=t),rows:"2",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-800",placeholder:"Tambahkan catatan jika perlu..."},null,512),[[v,I.value]])])])):g("",!0),e("div",Rn,[e("button",{onClick:Le,disabled:T.value,class:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition disabled:opacity-50"},n(T.value?"Memproses...":"✓ Approve"),9,Dn),e("button",{onClick:Se,disabled:T.value,class:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition disabled:opacity-50"},n(T.value?"Memproses...":"✗ Tolak"),9,$n),e("button",{onClick:W,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition"}," Batal ")])])])])):g("",!0),ee.value?(l(),r("div",{key:3,class:"fixed inset-0 z-50 overflow-y-auto",onClick:$(xe,["self"])},[e("div",Gn,[a[139]||(a[139]=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),e("div",Fn,[a[138]||(a[138]=e("h3",{class:"text-xl font-bold text-gray-900 mb-4"},"Detail Pembayaran",-1)),y.value?(l(),r("div",Kn,[e("div",Hn,[a[127]||(a[127]=e("h4",{class:"font-semibold text-gray-900 mb-2"},"Informasi Pelanggan",-1)),e("div",Yn,[e("p",null,[a[124]||(a[124]=e("span",{class:"font-medium"},"ID Pelanggan:",-1)),b(" "+n(y.value.pelanggan.id_pelanggan),1)]),e("p",null,[a[125]||(a[125]=e("span",{class:"font-medium"},"Nama:",-1)),b(" "+n(y.value.pelanggan.nama_pelanggan),1)]),e("p",null,[a[126]||(a[126]=e("span",{class:"font-medium"},"Wilayah:",-1)),b(" "+n(y.value.pelanggan.wilayah||"-"),1)])])]),e("div",En,[e("div",null,[a[128]||(a[128]=e("label",{class:"text-sm font-medium text-gray-500"},"Tanggal Pembayaran",-1)),e("p",Jn,n(me(y.value.tanggal_bayar)),1)]),e("div",null,[a[129]||(a[129]=e("label",{class:"text-sm font-medium text-gray-500"},"Bulan Bayar",-1)),e("p",Wn,n(J(y.value.bulan_bayar)),1)]),e("div",qn,[e("div",null,[a[130]||(a[130]=e("label",{class:"text-xs font-medium text-gray-500"},"Meteran Sebelum",-1)),e("p",On,n(y.value.meteran_sebelum||"-"),1)]),e("div",null,[a[131]||(a[131]=e("label",{class:"text-xs font-medium text-gray-500"},"Meteran Sesudah",-1)),e("p",Qn,n(y.value.meteran_sesudah||"-"),1)]),e("div",null,[a[132]||(a[132]=e("label",{class:"text-xs font-medium text-gray-500"},"Pemakaian",-1)),e("p",Xn,n(y.value.jumlah_kubik?y.value.jumlah_kubik+" m³":"-"),1)])]),y.value.abunemen?(l(),r("div",Zn,[...a[133]||(a[133]=[e("label",{class:"text-sm font-medium text-gray-500"},"Abunemen",-1),e("p",{class:"text-base text-gray-900"},[e("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},[e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})]),b(" Ya (Rp 3.000) ")])],-1)])])):g("",!0),e("div",null,[a[134]||(a[134]=e("label",{class:"text-sm font-medium text-gray-500"},"Jumlah Bayar",-1)),e("p",el,"Rp "+n(k(y.value.jumlah_bayar)),1)]),e("div",null,[a[135]||(a[135]=e("label",{class:"text-sm font-medium text-gray-500"},"Metode Pembayaran",-1)),e("p",al,n(y.value.metode_bayar),1)]),e("div",null,[a[136]||(a[136]=e("label",{class:"text-sm font-medium text-gray-500"},"Keterangan",-1)),e("p",tl,n(y.value.keterangan||"Lunas"),1)]),y.value.catatan?(l(),r("div",sl,[a[137]||(a[137]=e("label",{class:"text-sm font-medium text-gray-500"},"Catatan",-1)),e("p",nl,n(y.value.catatan),1)])):g("",!0)])])):g("",!0),e("div",{class:"mt-6 flex justify-end"},[e("button",{onClick:xe,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition"}," Tutup ")])])])])):g("",!0)]),_:1}))}};export{ul as default};
